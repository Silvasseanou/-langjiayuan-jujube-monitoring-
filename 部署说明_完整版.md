# 郎家园枣园农业监控系统 - 完整版部署说明

## 🚀 功能概述

本版本保留了**完整的市场分析和爬虫功能**，仅简化了硬件传感器部分（使用模拟数据）。

### 完整功能包括：

✅ **完整爬虫功能**：
- 淘宝商品数据采集
- 天猫商品数据采集
- 京东商品数据采集
- 拼多多商品数据采集
- 社交媒体数据采集（微博、抖音、小红书、知乎）

✅ **完整市场分析**：
- 价格趋势分析
- 消费者偏好分析
- 客户细分分析
- 市场机会分析
- 品牌推广建议

✅ **完整数据分析**：
- 机器学习预测
- 数据可视化（matplotlib、plotly）
- 情感分析
- 关键词分析

⚠️ **简化部分**：
- 硬件传感器（使用模拟数据）
- 物联网设备接入（使用模拟状态）

## 📋 部署步骤

### 1. 准备文件

确保以下文件已准备好：
- `app_full.py` - 完整功能主应用
- `requirements_full.txt` - 完整依赖库
- `modules/market_analysis.py` - 完整市场分析模块
- `modules/data_collection_simplified.py` - 简化数据收集模块
- `render.yaml` - 云平台配置

### 2. 云平台部署

#### 使用 Render 部署：

1. 连接 GitHub 仓库
2. 选择 `render.yaml` 配置文件
3. 自动安装依赖：
   ```bash
   pip install -r requirements_full.txt
   ```
4. 自动启动应用：
   ```bash
   gunicorn app_full:app --bind 0.0.0.0:$PORT
   ```

#### 使用 Heroku 部署：

1. 创建 Heroku 应用
2. 配置环境变量：
   ```bash
   heroku config:set PYTHONPATH=.
   heroku config:set DATABASE_URL=sqlite:///agriculture.db
   heroku config:set FLASK_ENV=production
   ```
3. 部署应用：
   ```bash
   git push heroku main
   ```

### 3. 本地测试

```bash
# 安装依赖
pip install -r requirements_full.txt

# 运行应用
python app_full.py

# 访问应用
# http://localhost:8080
```

## 🕸️ 爬虫功能详解

### 支持的电商平台：

1. **淘宝 (Taobao)**
   - 商品价格、销量、评分
   - 商品描述、关键词
   - 用户评论情感分析

2. **天猫 (Tmall)**
   - 品牌商品数据
   - 价格趋势分析
   - 品牌竞争分析

3. **京东 (JD)**
   - 商品详情和规格
   - 价格历史记录
   - 用户评价分析

4. **拼多多 (PDD)**
   - 团购价格数据
   - 销量统计
   - 用户偏好分析

### 社交媒体平台：

1. **微博 (Weibo)**
   - 话题热度分析
   - 用户情感倾向
   - 品牌提及统计

2. **抖音 (Douyin)**
   - 视频内容分析
   - 用户互动数据
   - 话题标签统计

3. **小红书 (Xiaohongshu)**
   - 用户笔记分析
   - 产品推荐统计
   - 用户评价情感

4. **知乎 (Zhihu)**
   - 专业问答分析
   - 用户观点统计
   - 知识热度分析

## 📊 数据分析功能

### 市场分析报告包含：

1. **价格分析**
   - 各平台价格对比
   - 价格区间分布
   - 价格趋势预测

2. **销量分析**
   - 热销产品排行
   - 销量趋势分析
   - 销售季节性分析

3. **用户偏好**
   - 评分分布分析
   - 用户评论关键词
   - 情感分析结果

4. **竞争分析**
   - 竞品对比分析
   - 市场份额统计
   - 优势劣势分析

## 🔧 API 接口

### 市场数据收集：
```
POST /api/collect-market-data
{
    "platforms": ["taobao", "tmall", "jd", "pinduoduo"]
}
```

### 获取市场分析：
```
GET /api/market-analysis
```

### 触发爬虫任务：
```
POST /api/crawler/start
{
    "platform": "taobao",
    "keywords": ["冬枣", "和田枣"]
}
```

## ⚙️ 环境配置

### 必需环境变量：

```env
DATABASE_URL=sqlite:///agriculture.db
FLASK_ENV=production
PYTHONPATH=.
PORT=8080

# 爬虫配置（可选）
SCRAPY_SETTINGS_MODULE=settings
USER_AGENT=Mozilla/5.0 (compatible; AgricultureBot/1.0)
DOWNLOAD_DELAY=2
```

### 可选配置：

```env
# 代理配置
HTTP_PROXY=http://proxy:port
HTTPS_PROXY=https://proxy:port

# 数据库配置
DATABASE_POOL_SIZE=10
DATABASE_TIMEOUT=30

# 缓存配置
REDIS_URL=redis://localhost:6379
CACHE_EXPIRE=3600
```

## 📈 性能优化

### 爬虫优化：
- 使用请求池管理连接
- 设置合理的延迟时间
- 实现自动重试机制
- 支持断点续传

### 数据分析优化：
- 使用 pandas 向量化操作
- 实现数据分页加载
- 缓存计算结果
- 异步数据处理

## 🔒 合规说明

### 爬虫合规：
- 遵守 robots.txt 规则
- 设置合理的请求频率
- 不采集用户隐私信息
- 仅用于学术研究目的

### 数据保护：
- 敏感数据加密存储
- 定期清理过期数据
- 用户数据匿名化处理
- 符合数据保护法规

## 🚨 部署注意事项

1. **依赖库兼容性**：
   - 确保 Python 版本 3.9+
   - 某些爬虫库可能需要系统级依赖

2. **内存使用**：
   - 数据分析功能占用内存较多
   - 建议使用至少 512MB 内存的服务器

3. **网络访问**：
   - 爬虫功能需要稳定的网络连接
   - 某些平台可能需要代理访问

4. **法律合规**：
   - 请确保爬虫使用符合当地法律法规
   - 建议仅用于学习和研究目的

## 📞 技术支持

如有问题，请检查：
1. 依赖库是否完整安装
2. 网络连接是否正常
3. 数据库是否正确初始化
4. 日志文件中的错误信息

## 🎯 下一步计划

- [ ] 添加更多电商平台支持
- [ ] 实现实时数据更新
- [ ] 增加数据可视化图表
- [ ] 支持自定义爬虫规则
- [ ] 添加数据导出功能 